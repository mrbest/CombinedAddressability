---
title: "addressableObligations"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r loadfromcsv}
source("opt_addressability.R")
sc <- sparkInit()
load_spark_csv(sc, "GWCM_FPDS_FY13_FY17_10082017.tsv")
spark_write_parquet(raw_df, path = "08OCT17FY13_17.prq")
```

```{r store_to_parquet}
spark_write_parquet(raw_df, path = "08OCT17FY13_17.prq")
```

```{r loadfiles}
source("opt_addressability.R")
sc <- sparkInit()
load_spark_parquet("08OCT17FY13_17.prq/")

```

```{r plotcats}
totals <<- training_transactions %>% group_by(level_1_category) %>% summarise(cat_total = sum(dollars_obligated)) %>% collect()
total_strings <- totals %>% mutate(dollar_totals = to_currency(cat_total, currency_symbol = "$", symbol_first = TRUE, group_size = 3, group_delim = ",", decimal_size = 2,decimal_delim = ".")) %>% collect()                                                                                                     

total_strings %>% filter(is.na(level_1_category) == FALSE)%>%
    ggplot(aes(x=as.factor(level_1_category), y=cat_total, label = dollar_totals) ) + 
    geom_col() +geom_text(angle=90, color = "orange", size = 3, position = position_stack(vjust = 0.5))+
    theme(axis.text.x  = element_text(angle=90, vjust=0.5, size=10))
```
## Calc Addressability for GSA and BIC

```{r getaddressability}
tic()
gsa_addressable_markets <-  process_gsa_contracts()
write_csv(gsa_addressable_markets, paste0("gsa_addressable_markets",Sys.Date(),".csv"))

bic_markets <- process_bic_contracts()
write_csv(bic_markets, paste0("bic_addressability",Sys.Date(),".csv"))
toc()


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r generate addressability matrix }
  
```

